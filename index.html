
<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="300">
    <title>Toffel Trading Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg-color: #0d1117; --card-bg: #161b22; --accent-blue: #58a6ff; --accent-green: #3fb950; --accent-red: #f85149; --accent-orange: #d29922; --text-main: #c9d1d9; --text-dim: #8b949e; --border-color: #30363d; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-main); padding: 1rem; }
        .container { max-width: 1400px; margin: 0 auto; }
        
        /* Navigatie Tabs */
        .tabs { display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; }
        .tab-btn { background: none; border: 1px solid var(--border-color); color: var(--text-dim); padding: 0.8rem 2rem; border-radius: 2rem; cursor: pointer; font-weight: 600; transition: 0.3s; }
        .tab-btn.active { background: var(--accent-blue); color: #fff; border-color: var(--accent-blue); }
        .tab-btn:hover { border-color: var(--accent-blue); }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem; }
        .card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 1rem; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; }
        .macro-card { border-left: 4px solid var(--accent-blue); }
        .ticker-row { display:flex; justify-content:space-between; align-items:center; }
        .ticker { font-size: 1.8rem; font-weight: 700; color: var(--accent-blue); }
        .badge { padding: 0.4rem 0.8rem; border-radius: 0.5rem; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; }
        .BUY { background: rgba(63, 185, 80, 0.15); color: var(--accent-green); border: 1px solid var(--accent-green); }
        .SELL { background: rgba(248, 81, 73, 0.15); color: var(--accent-red); border: 1px solid var(--accent-red); }
        .HOLD { background: rgba(139, 148, 158, 0.1); color: var(--text-dim); border: 1px solid var(--border-color); }
        .EXIT { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); border: 1px solid var(--accent-red); }
        
        .price { font-size: 2.5rem; font-weight: 700; }
        .levels-box { display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,255,255,0.03); border-radius: 0.5rem; border: 1px dashed var(--border-color); font-size: 0.85rem; }
        .metric-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .metric { background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px; }
        .lab { font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; }
        .val { font-size: 1rem; font-weight: 600; display: block; }
        .sentiment-bar { height: 6px; background: #333; border-radius: 3px; overflow: hidden; margin-top: 5px; }
        .sentiment-fill { height: 100%; transition: 0.5s; }
        .chart-wrap { height: 180px; width: 100%; position: relative; margin-top: 10px; }
        .confirmation { font-size: 0.75rem; display: flex; align-items: center; gap: 5px; margin-top: 5px; }
        .dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; }
        
        .summary-box { background: rgba(210, 153, 34, 0.05); border: 1px solid var(--accent-orange); border-radius: 1rem; padding: 1.2rem; margin-bottom: 2rem; }
        .summary-item { display: inline-block; background: rgba(255,255,255,0.05); padding: 0.5rem 1rem; border-radius: 0.5rem; margin-right: 0.8rem; margin-bottom: 0.5rem; font-size: 0.9rem; border: 1px solid var(--border-color); }
        .summary-ticker { font-weight: 700; color: var(--accent-blue); margin-right: 5px; }
        
        .info-box { background: rgba(88, 166, 255, 0.05); border: 1px solid var(--accent-blue); border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem; line-height: 1.6; }
        .info-title { color: var(--accent-blue); font-size: 1rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 10px; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; font-size: 0.85rem; }
        .info-item b { color: #fff; }
        .fund-item { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; position: relative; overflow: hidden; }
        .fund-rank { position: absolute; top: 0; left: 0; background: var(--accent-blue); color: #fff; padding: 0.2rem 0.8rem; font-weight: 700; font-size: 0.8rem; border-bottom-right-radius: 0.5rem; }
    </style>
</head>
<body>
    <div class="container">
        <header style="text-align:center; padding: 1.5rem 0;">
            <h1 style="color:#fff; font-size:2.5rem;">Toffel Trading Tool <span style="font-size: 1rem; color: var(--accent-blue); vertical-align: middle;">v4.0</span></h1>
            <div style="margin-top: 0.5rem; color: var(--accent-orange); font-weight: 600; font-size: 0.9rem;">
                üïí Laatste update: 15:15:05 | <a href="javascript:location.reload(true)" style="color: var(--accent-blue); text-decoration: none;">üîÑ Ververs nu</a>
            </div>
        </header>

        <div class="summary-box" id="ai-summary">
            <h2 style="font-size: 0.8rem; color: var(--accent-orange); margin-bottom: 0.8rem; text-transform: uppercase; letter-spacing: 1px;">üöÄ AI Market Opportunities (Best Picks)</h2>
            <div id="market-summary">Geen directe kansen gedetecteerd.</div>
        </div>

        <nav class="tabs">
            <button class="tab-btn active" onclick="openTab('stocks')">Aandelen</button>
            <button class="tab-btn" onclick="openTab('etfs')">ETF-ETC</button>
            <button class="tab-btn" onclick="openTab('macro')">Macro</button>
            <button class="tab-btn" onclick="openTab('analysis_knowledge')">üìä Analyse Kennis</button>
            <button class="tab-btn" onclick="openTab('guide')">üìñ Handleiding</button>
            <button class="tab-btn" onclick="openTab('planner')">üõ°Ô∏è Risico Management</button>
        </nav>

        <section id="stocks" class="tab-content active">
            <div class="grid"></div>
        </section>

        <section id="etfs" class="tab-content">
            <div class="grid"></div>
        </section>

        <section id="macro" class="tab-content">
            <div class="info-box">
                <div class="info-title">üìñ Macro-Legende: Hoe lees ik deze data?</div>
                <div class="info-grid">
                    <div class="info-item">
                        <b>üìâ VIX (Angstmeter):</b> Meet de nervositeit. <br> 
                        Low (<20): Rustige markt, goed voor aandelen. <br> 
                        High (>25): Paniek, wees voorzichtig met nieuwe aankopen.
                    </div>
                    <div class="info-item">
                        <b>üíµ DXY (Dollar Index):</b> De waarde van de Dollar. <br> 
                        Stijgend: Meestal <u>slecht</u> voor Goud en Zilver. <br> 
                        Dalend: De "Turbo" voor je grondstoffen (ETC's).
                    </div>
                    <div class="info-item">
                        <b>üìà TNX (10-jaars Rente):</b> De marktrente USA. <br> 
                        Stijgend: Tech-aandelen (MSFT, GOOGL) worden minder waard. <br> 
                        Dalend: Positief voor groei-aandelen en tech.
                    </div>
                    <div class="info-item">
                        <b>üèóÔ∏è Grondstoffen Futures:</b> <br> 
                        <b>GOUD (GC=F):</b> Voorloper voor SGLD. <br>
                        <b>ZILVER (SI=F):</b> Voorloper voor PHAG. <br>
                        <b>KOPER (HG=F):</b> Voorloper voor COPM. <br>
                        <b>OLIE (CL=F):</b> Globale energieprijs.
                    </div>
                </div>
            </div>
            <div class="grid"></div>
        </section>

        <section id="guide" class="tab-content">
            <div class="info-box" style="border-color: var(--accent-orange); background: rgba(210, 153, 34, 0.05);">
                <div class="info-title" style="color: var(--accent-orange);">üìò Dashboard Gids: Hoe word ik een Master Trader?</div>
                
                <div class="fund-item">
                    <h3 style="color: #fff; margin-bottom: 0.8rem;">1. De AI Signals (Badges)</h3>
                    <p style="font-size: 0.9rem; line-height: 1.5;">
                        <b>BUY:</b> Alle lichten op groen. RSI laag, trend positief, hoog volume. <br>
                        <b>HOLD:</b> Geen actie nodig. De koers volgt zijn natuurlijke weg. <br>
                        <b>SELL:</b> De koers is oververhit (RSI > 70) of de trend draait. <br>
                        <b>EXIT:</b> Nooduitgang. De koers is onder je Trailing Stop gezakt. Bescherm je kapitaal!
                    </p>
                </div>

                <div class="fund-item">
                    <h3 style="color: var(--accent-blue); margin-bottom: 0.8rem;">2. AI Confidence Score (%)</h3>
                    <p style="font-size: 0.9rem; line-height: 1.5;">
                        Dit is de "betrouwbaarheid" van de huidige status. <br>
                        <b>> 80%:</b> Zeer sterke overtuiging van de AI. Meerdere indicatoren bevestigen elkaar. <br>
                        <b>50-70%:</b> Normale marktconditie. <br>
                        <b>< 40%:</b> Onvoorspelbaar of overstretched. Wees voorzichtig.
                    </p>
                </div>

                <div class="fund-item">
                    <h3 style="color: var(--accent-green); margin-bottom: 0.8rem;">3. De Interactieve Grafiek (v2.2)</h3>
                    <p style="font-size: 0.9rem; line-height: 1.5;">
                        <b>üî¥ Weerstand R1 (Lijn):</b> Het plafond. De koers kan hier moeite hebben om door te breken. <br>
                        <b>üü¢ Support S1 (Gestippeld):</b> De vloer van de koers. Koop nabij deze lijn. (Gestippeld = Groen). <br>
                        <b>üìä Volume (Balken):</b> Grijze balken onderaan. Bevestigen de kracht van de beweging. <br>
                        <b>üìâ Stop-Loss (Lijn):</b> Rode stippellijn. Beschermt tegen te grote verliezen. <br>
                        <b>‚ö™ RSI Punten:</b> Gekleurde bollen op de lijn (<30 groen, >70 rood). <br>
                        <b>üß≤ MA50 (Trend):</b> De dikke gestreepte lijn. Prijs erboven = Bullish.
                    </p>
                </div>

                <div class="fund-item">
                    <h3 style="color: #fff; margin-bottom: 0.8rem;">4. Momentum (24u %)</h3>
                    <p style="font-size: 0.9rem; line-height: 1.5;">
                        Direct onder de prijs zie je de stijging of daling van vandaag. <br>
                        <b>Groen:</b> Het aandeel heeft momentum en trekt kopers aan. <br>
                        <b>Rood:</b> Er is verkoopdruk; wees alert als de koers richting je Trailing Stop zakt.
                    </p>
                </div>

                <div class="fund-item">
                    <h3 style="color: var(--accent-orange); margin-bottom: 0.8rem;">5. Fundamentele Quick-Check</h3>
                    <p style="font-size: 0.9rem; line-height: 1.5;">
                        <b>K/W:</b> Is de prijs eerlijk? (Lager is vaak goedkoper). <br>
                        <b>EPS Groei:</b> Maakt het bedrijf meer winst dan vroeger? <br>
                        <b>ROE:</b> Is het management effici√´nt met jouw geld?
                    </p>
                </div>

                <div class="fund-item">
                    <h3 style="color: var(--accent-orange); margin-bottom: 0.8rem;">6. Waardering: Analyst Target</h3>
                    <p style="font-size: 0.9rem; line-height: 1.5;">
                        <b>Fair Value:</b> Het gemiddelde koersdoel van professionele analisten (Wall Street Consensus). <br>
                        <b>Upside Potential:</b> Hoeveel % de koers nog kan stijgen tot het koersdoel. <br>
                        <b>Positief:</b> Als er nog veel ruimte (Upside) over is om te groeien. <br>
                        <b>Negatief:</b> Als de prijs al hoger is dan wat analisten verantwoord vinden.
                    </p>
                </div>
                <div class="fund-item">
                    <h3 style="color: #fff; margin-bottom: 0.8rem;">7. Automatische Updates</h3>
                    <p style="font-size: 0.9rem; line-height: 1.5;">
                        Dit dashboard ververst elke <b>15 minuten</b> de data via de Raspberry Pi en ververst Safari elke <b>5 minuten</b>.
                    </p>
                </div>
            </div>
        </section>

        <section id="planner" class="tab-content">
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
                <!-- Input Card -->
                <div class="card">
                    <h2 style="color: var(--accent-blue); margin-bottom: 1rem;">üßÆ Positie Calculator</h2>
                    
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div>
                            <label style="display: block; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 0.3rem;">Kapitaal (‚Ç¨/$)</label>
                            <input type="number" id="calc-capital" value="10000" style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border-color); color: #fff; padding: 0.8rem; border-radius: 0.5rem;">
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label style="display: block; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 0.3rem;">Risico (%)</label>
                                <input type="number" id="calc-risk" value="1.0" step="0.1" style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border-color); color: #fff; padding: 0.8rem; border-radius: 0.5rem;">
                            </div>
                             <div>
                                <label style="display: block; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 0.3rem;">Entry Prijs</label>
                                <input type="number" id="calc-entry" placeholder="bv. 150.00" style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border-color); color: #fff; padding: 0.8rem; border-radius: 0.5rem;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label style="display: block; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 0.3rem;">Stop Loss</label>
                                <input type="number" id="calc-stop" placeholder="bv. 145.00" style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border-color); color: #fff; padding: 0.8rem; border-radius: 0.5rem; border-color: var(--accent-red);">
                            </div>
                             <div>
                                <label style="display: block; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 0.3rem;">Take Profit (Optioneel)</label>
                                <input type="number" id="calc-target" placeholder="bv. 165.00" style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border-color); color: #fff; padding: 0.8rem; border-radius: 0.5rem; border-color: var(--accent-green);">
                            </div>
                        </div>

                        <button onclick="calculateTrade()" style="background: var(--accent-blue); color: #fff; border: none; padding: 1rem; border-radius: 0.5rem; font-weight: 700; cursor: pointer; margin-top: 0.5rem;">BEREKEN POSITIE</button>
                    </div>
                </div>

                <!-- Result Card -->
                <div class="card" id="calc-results" style="display: none;">
                    <h2 style="color: var(--accent-green); margin-bottom: 1rem;">‚úÖ Jouw Trade Plan</h2>
                    
                    <div class="metric-grid" style="grid-template-columns: 1fr;">
                        <div class="metric" style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="lab">Aantal Aandelen</span>
                            <span class="val" id="res-shares" style="font-size: 1.5rem; color: #fff;">0</span>
                        </div>
                         <div class="metric" style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="lab">Totale Investering</span>
                            <span class="val" id="res-invest" style="color: var(--text-main);">‚Ç¨0.00</span>
                        </div>
                        <div class="metric" style="display: flex; justify-content: space-between; align-items: center;">
                             <span class="lab">Risico Bedrag (R)</span>
                            <span class="val" id="res-risk" style="color: var(--accent-red);">‚Ç¨0.00</span>
                        </div>
                         <div class="metric" style="display: flex; justify-content: space-between; align-items: center;">
                             <span class="lab">Risk / Reward Ratio</span>
                            <span class="val" id="res-rr" style="color: var(--accent-orange);">-</span>
                        </div>
                    </div>

                    <div class="info-box" style="margin-top: 1rem; margin-bottom: 0; padding: 1rem;">
                        <div style="font-size: 0.85rem; line-height: 1.5;" id="res-advice">
                            Vul de gegevens in om advies te krijgen.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="analysis_knowledge" class="tab-content">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 2rem;">
                <!-- Technische Analyse Kolom -->
                <div>
                    <div class="info-box" style="border-color: var(--accent-blue); background: rgba(88, 166, 255, 0.05); height: 100%;">
                        <div class="info-title">üõ†Ô∏è Technische Analyse</div>
                        <p style="font-size: 0.85rem; margin-bottom: 1.5rem; color: var(--text-dim);">Focus op <u>momentum</u> en <u>timing</u>.</p>

                        <div class="fund-item">
                            <h4 style="color: var(--accent-blue); margin-bottom: 0.3rem;">Moving Averages (MA50/200)</h4>
                            <p style="font-size: 0.85rem;">De ruggengraat van de trend. Golden Cross (MA50 > MA200) is extreem bullish.</p>
                        </div>
                        <div class="fund-item">
                            <h4 style="color: var(--accent-green); margin-bottom: 0.3rem;">RSI (Overbought/Oversold)</h4>
                            <p style="font-size: 0.85rem;">< 30 is koopmoment, > 70 is winst nemen.</p>
                        </div>
                        <div class="fund-item">
                            <h4 style="color: var(--accent-orange); margin-bottom: 0.3rem;">Support (S1) & Resistance (R1)</h4>
                            <p style="font-size: 0.85rem;">De psychologische vloer en het plafond van de koers.</p>
                        </div>
                        <div class="fund-item">
                            <h4 style="color: var(--accent-red); margin-bottom: 0.3rem;">ATR Trailing Stop</h4>
                            <p style="font-size: 0.85rem;">De risico-grens. Breekt de prijs hieronder? Dan is het EXIT.</p>
                        </div>
                    </div>
                </div>

                <!-- Fundamentele Analyse Kolom -->
                <div>
                    <div class="info-box" style="border-color: var(--accent-green); background: rgba(63, 185, 80, 0.05); height: 100%;">
                        <div class="info-title" style="color: var(--accent-green);">üèóÔ∏è Fundamentele Analyse</div>
                        <p style="font-size: 0.85rem; margin-bottom: 1.5rem; color: var(--text-dim);">Focus op <u>kwaliteit</u> en <u>waarde</u>.</p>

                        <div class="fund-item">
                            <h4 style="color: var(--accent-green); margin-bottom: 0.3rem;">EPS Groei (Winststijging)</h4>
                            <p style="font-size: 0.85rem;">Stijgt de winst per aandeel? Dit is de motor achter de koers.</p>
                        </div>
                        <div class="fund-item">
                            <h4 style="color: var(--accent-blue); margin-bottom: 0.3rem;">K/W Verhouding (Price/Earnings)</h4>
                            <p style="font-size: 0.85rem;">Wat betaal je voor 1 euro winst? Lager is vaak relatief goedkoper.</p>
                        </div>
                        <div class="fund-item">
                            <h4 style="color: var(--accent-orange); margin-bottom: 0.3rem;">ROE (Return on Equity)</h4>
                            <p style="font-size: 0.85rem;">Management effici√´ntie. > 15% wijst op een topbedrijf.</p>
                        </div>
                        <div class="fund-item">
                            <h4 style="color: var(--accent-red); margin-bottom: 0.3rem;">Schuldgraad (Debt/Equity)</h4>
                            <p style="font-size: 0.85rem;">Is het bedrijf financieel gezond? Ratio < 1.0 is ideaal.</p>
                        </div>
                        <div class="fund-item">
                            <h4 style="color: var(--accent-green); margin-bottom: 0.3rem;">Analyst Target (Upside)</h4>
                            <p style="font-size: 0.85rem;">Het oordeel van Wall Street. Positieve Upside betekent dat professionals hogere koersen verwachten.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
    const chartData = {};
    
    function openTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function initCharts() {
        Object.keys(chartData).forEach(ticker => {
            const canvas = document.getElementById('chart-' + ticker.replace('.', '-'));
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const data = chartData[ticker];
            
            // RSI Color Mapping voor de punten
            const pointColors = data.rsi_hist ? data.rsi_hist.map(r => {
                if (r < 35) return '#3fb950'; // Koopkans (groen)
                if (r > 65) return '#f85149'; // Oververhit (rood)
                return 'transparent';
            }) : [];

            try {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [
                            {
                                label: 'Prijs',
                                data: data.prices,
                                borderColor: '#58a6ff',
                                borderWidth: 3,
                                fill: false,
                                pointRadius: data.rsi_hist ? data.prices.map((_, i) => (data.rsi_hist[i] < 35 || data.rsi_hist[i] > 65 ? 4 : 0)) : 0,
                                pointBackgroundColor: pointColors,
                                tension: 0.3
                            },
                            {
                                label: 'MA50',
                                data: data.ma50,
                                borderColor: 'rgba(210, 153, 34, 0.7)',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                fill: false,
                                pointRadius: 0,
                                tension: 0.3
                            },
                            {
                                label: 'MA200',
                                data: data.ma200,
                                borderColor: 'rgba(163, 113, 247, 0.8)',
                                borderWidth: 2,
                                fill: false,
                                pointRadius: 0,
                                tension: 0.3
                            },
                            {
                                label: 'Resistance R1',
                                data: Array(data.prices.length).fill(data.r1),
                                borderColor: 'rgba(248, 81, 73, 0.8)', // Iets feller
                                borderWidth: 3, // Dikker v3.5
                                fill: false,
                                pointRadius: 0
                            },
                            {
                                label: 'Support S1',
                                data: Array(data.prices.length).fill(data.s1),
                                borderColor: 'rgba(63, 185, 80, 1)', // Volledig dekkend
                                borderWidth: 3, 
                                borderDash: [6, 4], // Gestippeld om overlap te tonen v3.6
                                fill: false,
                                pointRadius: 0
                            },
                            {
                                label: 'Stop Loss',
                                data: Array(data.prices.length).fill(data.stop_loss),
                                borderColor: 'rgba(255, 255, 255, 0.3)',
                                borderWidth: 1,
                                borderDash: [2, 2],
                                fill: false,
                                pointRadius: 0
                            },
                            {
                                type: 'bar',
                                label: 'Volume',
                                data: data.volumes,
                                backgroundColor: 'rgba(139, 148, 158, 0.25)',
                                yAxisID: 'yVol',
                                borderRadius: 2
                            }
                        ]
                    },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: { 
                                x: { display: false },
                                y: { 
                                    ticks: { color: '#8b949e', font: { size: 10 } }, 
                                    grid: { color: '#30363d' },
                                    grace: '5%' // Native padding v3.5
                                },
                                yVol: { display: false, position: 'right', suggestedMax: (data.volumes && data.volumes.length) ? Math.max(...data.volumes) * 5 : 100 }
                            }
                        }
                });
            } catch(e) { console.error("Chart error for " + ticker, e); }
        });
    }
    function calculateTrade() {
        const capital = parseFloat(document.getElementById('calc-capital').value);
        const riskPct = parseFloat(document.getElementById('calc-risk').value);
        const entry = parseFloat(document.getElementById('calc-entry').value);
        const stop = parseFloat(document.getElementById('calc-stop').value);
        const target = parseFloat(document.getElementById('calc-target').value);

        if (!entry || !stop || !capital || !riskPct) {
            alert("Vul minimaal Kapitaal, Risico, Entry en Stop Loss in!");
            return;
        }

        const riskAmount = capital * (riskPct / 100);
        const riskPerShare = Math.abs(entry - stop);
        
        if (riskPerShare === 0) {
            alert("Entry en Stop Loss mogen niet gelijk zijn!");
            return;
        }

        const shares = Math.floor(riskAmount / riskPerShare);
        const totalInvest = shares * entry;

        document.getElementById('res-shares').innerText = shares;
        document.getElementById('res-invest').innerText = totalInvest.toFixed(2);
        document.getElementById('res-risk').innerText = riskAmount.toFixed(2);

        let rrText = "-";
        if (target) {
            const rewardPerShare = Math.abs(target - entry);
            const rr = rewardPerShare / riskPerShare;
            rrText = "1 : " + rr.toFixed(2);
            document.getElementById('res-rr').innerText = rrText;
            document.getElementById('res-rr').style.color = rr > 2 ? 'var(--accent-green)' : 'var(--accent-orange)';
        } else {
             document.getElementById('res-rr').innerText = "-";
        }

        document.getElementById('calc-results').style.display = 'flex';
        
        // Advies
        const adviceDiv = document.getElementById('res-advice');
        if (totalInvest > capital) {
            adviceDiv.innerHTML = `<span style='color: var(--accent-red); font-weight: bold;'>‚ö†Ô∏è Let op:</span> Je hebt niet genoeg kapitaal voor deze trade. Je hebt ${totalInvest.toFixed(2)} nodig.`;
        } else {
            adviceDiv.innerHTML = `<span style='color: var(--accent-green); font-weight: bold;'>‚úÖ Goed plan:</span> Je riskeert ${riskPct}% van je account. Als de stop wordt geraakt, verlies je maximaal ${riskAmount.toFixed(2)}.`;
        }
    }

    window.onload = initCharts;
    </script>
</body>
</html>
